
시작할 때 정의가 조금 구체적으로 될 필요가 있습니다. "동시" 라는게 뭘까요?
이 동시에는 보통 멀티 쓰레드, 멀티 프로세스 기반의 컨텍스트 스위칭이 일어나서 서로 어떤 것이 먼저 일어날지, 순서를 보장할 수 없는 경우라고 생각합니다

 

같은 DB Table Row를 업데이트 한다. 라는 부분은 뭘까요?

같은 테이블의 Row를 업데이트 하는 경우만이면 사실 큰 문제가 안 될 수가 있습니다. 예를들면

ID, Name, Age 

1  Be-Student 22

이제 Id가 1번인 데이터를 업데이트 하는 경우를 생각해봅시다. 

1번째 요청은 Id가 1인 사람의 Name을 Hello world로

2번째 요청은 Id가 1인 사람의 Age를 100살로

변경한다고 생각해봅시다.

순서에 관계없이 문제가 없을겁니다. 어떤게 어떻게 진행되든 문제가 없을건데요 

 

문제가 있는 케이스를 돌아보도록 하겠습니다. 

1번째 요청은 Id가 1인 사람의 이름을 "Hello"로,

2번째 요청은 Id가 1인 사람의 이름을 "World"로 

동시와 가깝게 요청이 되었을 때, "Hello"로 남아 있을지, "World"로 남아있을 지를 판단할 수가 없습니다.

이는 순서에 따라 처리가 되게 이상해지는 문제가 발생하죠.

 

1,2번째 요청이 거의 동시에 도달했을 경우를 막는 것은 싱글 쓰레드로 하는 것 이외에는 사실상 방법이 없습니다. 동시가 발생하지 않도록 하는 방법인거죠. 

이를 위해서는 "동일한 데이터를 참조할만한 요청"의 경우에는 같은 thread 풀에 있는 thread를 호출하는 방법을 사용할 수 있습니다.

근데 이 요청이 어디서부터 일지도 모르는데 무조건 같은 thread로 다룬다는 것은 너무 비효율적입니다. 그러면 Message 큐, 를 사용할 수 있습니다. 당연하지만, 순서를 알기 위해서는 TimeStamp를 같이 찍어서 이를 기준으로 정렬한다면, 적어도 문제가 발생할 일은 없을겁니다. TimeStamp를 사용하는 것이 개인적으로는 가장 나은 방법이 아닐까 싶습니다. 
